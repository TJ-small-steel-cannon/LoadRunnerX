import{N as q,g as A,u as $,o as oe,r as w,a as b,c as se,b as le,d as re,e as ae,f as m,h as o,w as r,E as ne,i as ie,j as y,k as O,l as P,m as de,n as I,t as E,s as ue,p as me,q as ce,v as pe,x as fe,y as ge,z as _e,A as be,B as he}from"./index-4e40011e.js";import{e as ve,u as ye,s as we}from"./jsencrypt.min-12ac9c79.js";import{a as D}from"./axios-47b9d439.js";import{d as xe,e as Se}from"./jsencrpyt-7316e593.js";const Ie={set(e,l){sessionStorage&&e!=null&&l!=null&&sessionStorage.setItem(e,l)},get(e){return!sessionStorage||e==null?null:sessionStorage.getItem(e)},setJSON(e,l){l!=null&&this.set(e,JSON.stringify(l))},getJSON(e){const l=this.get(e);if(l!=null)return JSON.parse(l)},remove(e){sessionStorage.removeItem(e)}},Ve={set(e,l){localStorage&&e!=null&&l!=null&&localStorage.setItem(e,l)},get(e){return!localStorage||e==null?null:localStorage.getItem(e)},setJSON(e,l){l!=null&&this.set(e,JSON.stringify(l))},getJSON(e){const l=this.get(e);if(l!=null)return JSON.parse(l)},remove(e){localStorage.removeItem(e)}},z={session:Ie,local:Ve},J={401:"认证失败，无法访问系统资源",403:"当前操作没有权限",404:"访问资源不存在",default:"系统未知错误，请反馈给管理员"};function Re(e){let l="";for(const g of Object.keys(e)){const u=e[g];var a=encodeURIComponent(g)+"=";if(u!==null&&u!==""&&typeof u<"u")if(typeof u=="object"){for(const f of Object.keys(u))if(u[f]!==null&&u[f]!==""&&typeof u[f]<"u"){let n=g+"["+f+"]";var c=encodeURIComponent(n)+"=";l+=c+encodeURIComponent(u[f])+"&"}}else l+=a+encodeURIComponent(u)+"&"}return l}const Z={VITE_BASE_API:"/prod-api",BASE_URL:"/",MODE:"prod",DEV:!1,PROD:!0,SSR:!1};let M={show:!1};D.defaults.headers["Content-Type"]="application/json;charset=utf-8";const R=D.create({baseURL:Z.VITE_BASE_API,timeout:1e4});console.log("当前环境",Z.VITE_BASE_API);R.interceptors.request.use(e=>{q.start();const l=(e.headers||{}).isToken===!1;if(A()&&!l&&(e.headers.Authorization="Bearer "+A()),e.method==="get"&&e.params){let a=e.url+"?"+Re(e.params);a=a.slice(0,-1),e.params={},e.url=a}if(e.method==="post"||e.method==="put"){const a={url:e.url,data:typeof e.data=="object"?JSON.stringify(e.data):e.data,time:new Date().getTime()},c=z.session.getJSON("sessionObj");if(c==null||c==="")z.session.setJSON("sessionObj",a);else{const g=c.url,u=c.data,f=c.time,n=1e3;if(u===a.data&&a.time-f<n&&g===a.url){const _="数据正在处理，请勿重复提交";return console.warn(`[${g}]: `+_),Promise.reject(new Error(_))}else z.session.setJSON("sessionObj",a)}}return e},e=>{console.log(e),Promise.reject(e)});R.interceptors.response.use(e=>{q.done();const l=e.data.code||200,a=J[l]||e.data.msg||J.default;return e.request.responseType==="blob"||e.request.responseType==="arraybuffer"?e.data:l===401?(M.show||(M.show=!0,$().replace("/401")),Promise.reject("无效的会话，或者会话已过期，请重新登录。")):l===500?(ve(a),Promise.reject(new Error(a))):e.data});function Te(){return R({url:"/captchaImage",headers:{isToken:!1},method:"get",timeout:2e4})}function Ce(e){return R({url:"/login",headers:{isToken:!1},method:"post",timeout:1e4,data:e})}const Ne={class:"login"},ke={class:"loginContainer"},Oe=m("span",{class:"title"},"欢迎登录 LoadRunnerX 压力测试平台",-1),Pe={class:"codeImg"},Ee={class:"codeInput"},ze={class:"operate"},Ue={class:"phoneCode"},Fe=m("div",{class:"divider"},null,-1),je={class:"emailCode"},Be=m("div",{class:"divider"},null,-1),Ae={class:"publicModule"},Je={class:"gotoRegister"},Ze={__name:"Login",setup(e){oe(()=>{T()});const l=$(),a=ye(),c=w(null),g=w(null),u=w(null);let f=w("");const n=b({isRememberPassword:a.userInfo.isRememberPassword,userName:a.userInfo.userName,password:xe(a.userInfo.password),code:a.userInfo.code,uuid:""}),_=b({phone:"",code:""}),x=b({email:"",code:""}),S=w("account"),K=b({userName:[{required:!0,message:"请输入用户名!",trigger:"change"}],password:[{required:!0,message:"请输入密码!",trigger:"change"}],code:[{required:!0,message:"请输入验证码!",trigger:"change"}]}),X=b({phone:[{validator(s,t,i){!/^1[3-9]\d{9}$/.test(t)&&t!=""?(v.disabled=!0,i(new Error("请输入正确手机号"))):(t==""?v.disabled=!0:v.disabled=!1,i())},trigger:"change"}],code:[{required:!0,message:"请输入验证码!",trigger:"change"}]}),G=b({email:[{validator(s,t,i){!/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{3,4})$/.test(t)&&t!=""?(h.disabled=!0,i(new Error("请输入正确邮箱"))):(t==""?h.disabled=!0:h.disabled=!1,i())},trigger:"change"}],code:[{required:!0,message:"请输入验证码!",trigger:"change"}]}),V=w(!1),H=(s,t)=>{console.log(s,t)};function U(){S.value=="account"?c.value.validate(s=>{if(s){V.value=!0;const t={username:n.userName,password:n.password,code:n.code,uuid:n.uuid};Ce(t).then(i=>{if(i.code==200){if(n.isRememberPassword){const p={...n,password:Se(n.password),code:""};a.setuserInfo(p)}else{const p={userName:"",password:"",isRememberPassword:!1};a.setuserInfo(p)}ue(i.token),l.replace("/index")}}).catch(i=>{console.log("errMsg--->",i.message),T()}).finally(()=>{V.value=!1})}}):S.value=="phone"?g.value.validate(s=>{}):S.value=="email"&&u.value.validate(s=>{})}function T(){Te().then(s=>{s.code==200&&(f.value="data:image/gif;base64,"+s.img,n.uuid=s.uuid)})}const h=b({type:"primary",btnText:"获取验证码",disabled:!0}),v=b({type:"primary",btnText:"获取验证码",disabled:!0});function F(s){s.type="",s.disabled=!0,s.btnText="请稍候...",setTimeout(()=>{L(60,s)},500)}function L(s,t){we("验证码已发送!"),s=s||60,t.btnText=s+"s后获取",setTimeout(()=>{s>0&&(t.btnText=s+"s后获取",--s)},1e3);let i=setInterval(()=>{s>0?(t.btnText=s+"s后获取",--s):(t.btnText="获取验证码",t.disabled=!1,t.type="primary",clearInterval(i))},1e3)}const Q=se(()=>s=>s?"登录中":"登录");return(s,t)=>{const i=me,p=ce,W=pe,C=fe,Y=ge,j=_e,B=le("router-link"),N=be,k=he,ee=ne,te=ie;return re(),ae("div",Ne,[m("div",ke,[Oe,o(ee,{modelValue:S.value,"onUpdate:modelValue":t[11]||(t[11]=d=>S.value=d),class:"tabs",onTabClick:H},{default:r(()=>[o(N,{label:"密码登陆",name:"account"},{default:r(()=>[o(C,{model:n,ref_key:"accountFormRef",ref:c,rules:K,style:{width:"100%"}},{default:r(()=>[o(p,{prop:"userName"},{default:r(()=>[o(i,{modelValue:n.userName,"onUpdate:modelValue":t[0]||(t[0]=d=>n.userName=d),modelModifiers:{trim:!0},placeholder:"请输入用户名",clearable:"","prefix-icon":y(O),size:"large",style:{width:"100%"}},null,8,["modelValue","prefix-icon"])]),_:1}),o(p,{prop:"password"},{default:r(()=>[o(i,{modelValue:n.password,"onUpdate:modelValue":t[1]||(t[1]=d=>n.password=d),modelModifiers:{trim:!0},placeholder:"请输入密码",type:"password",clearable:"","prefix-icon":y(P),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),o(p,{prop:"code"},{default:r(()=>[m("div",Pe,[m("div",Ee,[o(i,{modelValue:n.code,"onUpdate:modelValue":t[2]||(t[2]=d=>n.code=d),modelModifiers:{trim:!0},placeholder:"请输入验证码",clearable:"",size:"large",onKeydown:t[3]||(t[3]=de(d=>U(c.value),["enter"]))},null,8,["modelValue"])]),m("div",{class:"codePicture",onClick:T},[o(W,{style:{width:"100%",height:"100%"},src:y(f),fit:"fill"},null,8,["src"])])])]),_:1})]),_:1},8,["model","rules"]),m("div",ze,[m("div",null,[o(Y,{modelValue:n.isRememberPassword,"onUpdate:modelValue":t[4]||(t[4]=d=>n.isRememberPassword=d),label:"记住密码",size:"small"},null,8,["modelValue"])]),m("div",null,[o(B,{to:"/member/retrievePassword"},{default:r(()=>[o(j,null,{default:r(()=>[I("忘记密码?")]),_:1})]),_:1})])])]),_:1}),o(N,{label:"短信登录",name:"phone"},{default:r(()=>[o(C,{model:_,ref_key:"phoneFormRef",ref:g,rules:X,style:{width:"100%"}},{default:r(()=>[o(p,{prop:"phone"},{default:r(()=>[o(i,{modelValue:_.phone,"onUpdate:modelValue":t[5]||(t[5]=d=>_.phone=d),modelModifiers:{trim:!0},placeholder:"请输入手机号",clearable:"","prefix-icon":y(O),size:"large",style:{width:"100%"}},null,8,["modelValue","prefix-icon"])]),_:1}),o(p,{prop:"code"},{default:r(()=>[m("div",Ue,[o(i,{modelValue:_.code,"onUpdate:modelValue":t[6]||(t[6]=d=>_.code=d),modelModifiers:{trim:!0},placeholder:"请输入验证码",type:"password","prefix-icon":y(P),size:"large"},null,8,["modelValue","prefix-icon"]),Fe,o(k,{link:"",type:v.type,class:"btnCode",disabled:v.disabled,onClick:t[7]||(t[7]=d=>F(v))},{default:r(()=>[I(E(v.btnText),1)]),_:1},8,["type","disabled"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),o(N,{label:"邮箱登陆",name:"email"},{default:r(()=>[o(C,{model:x,ref_key:"emailFormRef",ref:u,rules:G,style:{width:"100%"}},{default:r(()=>[o(p,{prop:"email"},{default:r(()=>[o(i,{modelValue:x.email,"onUpdate:modelValue":t[8]||(t[8]=d=>x.email=d),modelModifiers:{trim:!0},placeholder:"请输入邮箱",clearable:"","prefix-icon":y(O),size:"large",style:{width:"100%"}},null,8,["modelValue","prefix-icon"])]),_:1}),o(p,{prop:"code"},{default:r(()=>[m("div",je,[o(i,{modelValue:x.code,"onUpdate:modelValue":t[9]||(t[9]=d=>x.code=d),modelModifiers:{trim:!0},placeholder:"请输入验证码",type:"password","prefix-icon":y(P),size:"large"},null,8,["modelValue","prefix-icon"]),Be,o(k,{link:"",type:h.type,class:"btnCode",disabled:h.disabled,onClick:t[10]||(t[10]=d=>F(h))},{default:r(()=>[I(E(h.btnText),1)]),_:1},8,["type","disabled"])])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"]),m("div",Ae,[o(te,{direction:"vertical",size:15,alignment:"normal",style:{width:"100%"}},{default:r(()=>[o(k,{type:"primary",size:"large",class:"loginBtn",onClick:U,loading:V.value},{default:r(()=>[I(E(Q.value(V.value)),1)]),_:1},8,["loading"]),m("div",Je,[o(B,{to:"/member/register"},{default:r(()=>[o(j,{type:"primary"},{default:r(()=>[I("没有账号我要免费注册>>")]),_:1})]),_:1})])]),_:1})])])])}}};export{Ze as default};
