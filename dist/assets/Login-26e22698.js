import{g as R,u as T,o as M,r as v,a as C,c as F,b as D,d as $,e as K,f as c,h as r,w as l,E as X,i as G,j as y,k as H,l as Q,m as W,n as h,t as Y,s as Z,p as ee,q as te,v as se,x as oe,y as re,z as ae,A as le,B as ne}from"./index-bccd47a8.js";import{e as ie,u as ue}from"./jsencrypt.min-1d2336c6.js";import{a as x}from"./axios-47b9d439.js";import{d as de,e as ce}from"./jsencrpyt-355004e1.js";const me={set(e,s){sessionStorage&&e!=null&&s!=null&&sessionStorage.setItem(e,s)},get(e){return!sessionStorage||e==null?null:sessionStorage.getItem(e)},setJSON(e,s){s!=null&&this.set(e,JSON.stringify(s))},getJSON(e){const s=this.get(e);if(s!=null)return JSON.parse(s)},remove(e){sessionStorage.removeItem(e)}},pe={set(e,s){localStorage&&e!=null&&s!=null&&localStorage.setItem(e,s)},get(e){return!localStorage||e==null?null:localStorage.getItem(e)},setJSON(e,s){s!=null&&this.set(e,JSON.stringify(s))},getJSON(e){const s=this.get(e);if(s!=null)return JSON.parse(s)},remove(e){localStorage.removeItem(e)}},N={session:me,local:pe},V={401:"认证失败，无法访问系统资源",403:"当前操作没有权限",404:"访问资源不存在",default:"系统未知错误，请反馈给管理员"};function fe(e){let s="";for(const m of Object.keys(e)){const t=e[m];var o=encodeURIComponent(m)+"=";if(t!==null&&t!==""&&typeof t<"u")if(typeof t=="object"){for(const u of Object.keys(t))if(t[u]!==null&&t[u]!==""&&typeof t[u]<"u"){let _=m+"["+u+"]";var n=encodeURIComponent(_)+"=";s+=n+encodeURIComponent(t[u])+"&"}}else s+=o+encodeURIComponent(t)+"&"}return s}const j={VITE_BASE_API:"/prod-api",BASE_URL:"/",MODE:"prod",DEV:!1,PROD:!0,SSR:!1};let P={show:!1};x.defaults.headers["Content-Type"]="application/json;charset=utf-8";const w=x.create({baseURL:j.VITE_BASE_API,timeout:1e4});console.log("当前环境",j.VITE_BASE_API);w.interceptors.request.use(e=>{const s=(e.headers||{}).isToken===!1;if(R()&&!s&&(e.headers.Authorization="Bearer "+R()),e.method==="get"&&e.params){let o=e.url+"?"+fe(e.params);o=o.slice(0,-1),e.params={},e.url=o}if(e.method==="post"||e.method==="put"){const o={url:e.url,data:typeof e.data=="object"?JSON.stringify(e.data):e.data,time:new Date().getTime()},n=N.session.getJSON("sessionObj");if(n==null||n==="")N.session.setJSON("sessionObj",o);else{const m=n.url,t=n.data,u=n.time,_=1e3;if(t===o.data&&o.time-u<_&&m===o.url){const f="数据正在处理，请勿重复提交";return console.warn(`[${m}]: `+f),Promise.reject(new Error(f))}else N.session.setJSON("sessionObj",o)}}return e},e=>{console.log(e),Promise.reject(e)});w.interceptors.response.use(e=>{const s=e.data.code||200,o=V[s]||e.data.msg||V.default;return e.request.responseType==="blob"||e.request.responseType==="arraybuffer"?e.data:s===401?(P.show||(P.show=!0,T().replace("/401")),Promise.reject("无效的会话，或者会话已过期，请重新登录。")):s===500?(ie(o),Promise.reject(new Error(o))):e.data});function _e(){return w({url:"/captchaImage",headers:{isToken:!1},method:"get",timeout:2e4})}function ge(e){return w({url:"/login",headers:{isToken:!1},method:"post",timeout:1e4,data:e})}const be={class:"login"},he={class:"loginContainer"},ve=c("span",{class:"title"},"欢迎登录 LoadRunnerX 压力测试平台",-1),we={class:"codeImg"},Se={class:"codeInput"},Ie={class:"operate"},ye={class:"publicModule"},Ne={class:"gotoRegister"},Ce={__name:"Login",setup(e){M(()=>{S()});const s=T(),o=ue(),n=v(null);let m=v("");const t=C({isRememberPassword:o.userInfo.isRememberPassword,userName:o.userInfo.userName,password:de(o.userInfo.password),code:o.userInfo.code,uuid:""}),u=v("first"),_=C({userName:[{required:!0,message:"请输入用户名!",trigger:"change"}],password:[{required:!0,message:"请输入密码!",trigger:"change"}],code:[{required:!0,message:"请输入验证码!",trigger:"change"}]}),f=v(!1),J=(d,a)=>{console.log(d,a)};function E(d){d.validate(a=>{if(a){f.value=!0;const g={username:t.userName,password:t.password,code:t.code,uuid:t.uuid};ge(g).then(p=>{if(p.code==200){if(t.isRememberPassword){const b={...t,password:ce(t.password),code:""};o.setuserInfo(b)}else{const b={userName:"",password:"",isRememberPassword:!1};o.setuserInfo(b)}Z(p.token),s.replace("/index")}}).catch(p=>{console.log("errMsg--->",p.message),S()}).finally(()=>{f.value=!1})}})}function S(){_e().then(d=>{d.code==200&&(m.value="data:image/gif;base64,"+d.img,t.uuid=d.uuid)})}const B=F(()=>d=>d?"登录中":"登录");return(d,a)=>{const g=ee,p=te,b=se,U=oe,A=re,k=ae,O=D("router-link"),I=le,q=X,z=ne,L=G;return $(),K("div",be,[c("div",he,[ve,r(q,{modelValue:u.value,"onUpdate:modelValue":a[5]||(a[5]=i=>u.value=i),class:"tabs",onTabClick:J},{default:l(()=>[r(I,{label:"密码登陆",name:"first"},{default:l(()=>[r(U,{model:t,ref_key:"accountFormRef",ref:n,rules:_,style:{width:"100%"}},{default:l(()=>[r(p,{prop:"userName"},{default:l(()=>[r(g,{modelValue:t.userName,"onUpdate:modelValue":a[0]||(a[0]=i=>t.userName=i),modelModifiers:{trim:!0},placeholder:"请输入用户名",clearable:"","prefix-icon":y(H),size:"large",style:{width:"100%"}},null,8,["modelValue","prefix-icon"])]),_:1}),r(p,{prop:"password"},{default:l(()=>[r(g,{modelValue:t.password,"onUpdate:modelValue":a[1]||(a[1]=i=>t.password=i),modelModifiers:{trim:!0},placeholder:"请输入密码",type:"password",clearable:"","prefix-icon":y(Q),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),r(p,{prop:"code"},{default:l(()=>[c("div",we,[c("div",Se,[r(g,{modelValue:t.code,"onUpdate:modelValue":a[2]||(a[2]=i=>t.code=i),modelModifiers:{trim:!0},placeholder:"请输入验证码",clearable:"",size:"large",onKeydown:a[3]||(a[3]=W(i=>E(n.value),["enter"]))},null,8,["modelValue"])]),c("div",{class:"codePicture",onClick:S},[r(b,{style:{width:"100%",height:"100%"},src:y(m),fit:"fill"},null,8,["src"])])])]),_:1})]),_:1},8,["model","rules"]),c("div",Ie,[c("div",null,[r(A,{modelValue:t.isRememberPassword,"onUpdate:modelValue":a[4]||(a[4]=i=>t.isRememberPassword=i),label:"记住密码",size:"small"},null,8,["modelValue"])]),c("div",null,[r(O,{to:"/member/retrievePassword"},{default:l(()=>[r(k,null,{default:l(()=>[h("忘记密码?")]),_:1})]),_:1})])])]),_:1}),r(I,{label:"短信登录",name:"second"},{default:l(()=>[h("短信登录")]),_:1}),r(I,{label:"邮箱登陆",name:"third"},{default:l(()=>[h("邮箱登陆")]),_:1})]),_:1},8,["modelValue"]),c("div",ye,[r(L,{direction:"vertical",size:15,alignment:"normal",style:{width:"100%"}},{default:l(()=>[r(z,{type:"primary",size:"large",class:"loginBtn",onClick:a[6]||(a[6]=i=>E(n.value)),loading:f.value},{default:l(()=>[h(Y(B.value(f.value)),1)]),_:1},8,["loading"]),c("div",Ne,[r(O,{to:"/member/register"},{default:l(()=>[r(k,{type:"primary"},{default:l(()=>[h("没有账号我要免费注册>>")]),_:1})]),_:1})])]),_:1})])])])}}};export{Ce as default};
