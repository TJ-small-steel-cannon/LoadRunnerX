import{E as L,g as C,u as T,o as F,r as v,a as O,c as D,b as $,d as K,e as X,f as c,h as a,w as n,i as G,j as H,k as y,l as Q,m as W,n as Y,p as b,t as Z,s as ee,q as se,v as te,x as oe,y as re,z as ae,A as le,B as ne,C as ie}from"./index-93986280.js";import{u as ue,d as de,e as ce}from"./jsencrpyt-a6507992.js";import{a as P}from"./axios-47b9d439.js";const me={set(e,t){sessionStorage&&e!=null&&t!=null&&sessionStorage.setItem(e,t)},get(e){return!sessionStorage||e==null?null:sessionStorage.getItem(e)},setJSON(e,t){t!=null&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);if(t!=null)return JSON.parse(t)},remove(e){sessionStorage.removeItem(e)}},pe={set(e,t){localStorage&&e!=null&&t!=null&&localStorage.setItem(e,t)},get(e){return!localStorage||e==null?null:localStorage.getItem(e)},setJSON(e,t){t!=null&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);if(t!=null)return JSON.parse(t)},remove(e){localStorage.removeItem(e)}},N={session:me,local:pe};function fe(e){L({showClose:!0,message:e,type:"error"})}const R={401:"认证失败，无法访问系统资源",403:"当前操作没有权限",404:"访问资源不存在",default:"系统未知错误，请反馈给管理员"};function _e(e){let t="";for(const m of Object.keys(e)){const s=e[m];var o=encodeURIComponent(m)+"=";if(s!==null&&s!==""&&typeof s<"u")if(typeof s=="object"){for(const u of Object.keys(s))if(s[u]!==null&&s[u]!==""&&typeof s[u]<"u"){let _=m+"["+u+"]";var l=encodeURIComponent(_)+"=";t+=l+encodeURIComponent(s[u])+"&"}}else t+=o+encodeURIComponent(s)+"&"}return t}const x={VITE_BASE_API:"/prod-api",BASE_URL:"/",MODE:"prod",DEV:!1,PROD:!0,SSR:!1};let V={show:!1};P.defaults.headers["Content-Type"]="application/json;charset=utf-8";const w=P.create({baseURL:x.VITE_BASE_API,timeout:1e4});console.log("当前环境",x.VITE_BASE_API);w.interceptors.request.use(e=>{const t=(e.headers||{}).isToken===!1;if(C()&&!t&&(e.headers.Authorization="Bearer "+C()),e.method==="get"&&e.params){let o=e.url+"?"+_e(e.params);o=o.slice(0,-1),e.params={},e.url=o}if(e.method==="post"||e.method==="put"){const o={url:e.url,data:typeof e.data=="object"?JSON.stringify(e.data):e.data,time:new Date().getTime()},l=N.session.getJSON("sessionObj");if(l==null||l==="")N.session.setJSON("sessionObj",o);else{const m=l.url,s=l.data,u=l.time,_=1e3;if(s===o.data&&o.time-u<_&&m===o.url){const f="数据正在处理，请勿重复提交";return console.warn(`[${m}]: `+f),Promise.reject(new Error(f))}else N.session.setJSON("sessionObj",o)}}return e},e=>{console.log(e),Promise.reject(e)});w.interceptors.response.use(e=>{const t=e.data.code||200,o=R[t]||e.data.msg||R.default;return e.request.responseType==="blob"||e.request.responseType==="arraybuffer"?e.data:t===401?(V.show||(V.show=!0,T().replace("/401")),Promise.reject("无效的会话，或者会话已过期，请重新登录。")):t===500?(fe(o),Promise.reject(new Error(o))):e.data});function ge(){return w({url:"/captchaImage",headers:{isToken:!1},method:"get",timeout:2e4})}function he(e){return w({url:"/login",headers:{isToken:!1},method:"post",timeout:1e4,data:e})}const be={class:"login"},ve={class:"loginContainer"},we=c("span",{class:"title"},"欢迎登录 LoadRunnerX 压力测试平台",-1),Se={class:"codeImg"},Ie={class:"codeInput"},ye={class:"operate"},Ne={class:"publicModule"},Ee={class:"gotoRegister"},Re={__name:"Login",setup(e){F(()=>{S()});const t=T(),o=ue(),l=v(null);let m=v("");const s=O({isRememberPassword:o.userInfo.isRememberPassword,userName:o.userInfo.userName,password:de(o.userInfo.password),code:o.userInfo.code,uuid:""}),u=v("first"),_=O({userName:[{required:!0,message:"请输入用户名!",trigger:"change"}],password:[{required:!0,message:"请输入密码!",trigger:"change"}],code:[{required:!0,message:"请输入验证码!",trigger:"change"}]}),f=v(!1),j=(d,r)=>{console.log(d,r)};function E(d){d.validate(r=>{if(r){f.value=!0;const g={username:s.userName,password:s.password,code:s.code,uuid:s.uuid};he(g).then(p=>{if(p.code==200){if(s.isRememberPassword){const h={...s,password:ce(s.password),code:""};o.setuserInfo(h)}else{const h={userName:"",password:"",isRememberPassword:!1};o.setuserInfo(h)}ee(p.token),t.replace("/index")}}).catch(p=>{console.log("errMsg--->",p.message),S()}).finally(()=>{f.value=!1})}})}function S(){ge().then(d=>{d.code==200&&(m.value="data:image/gif;base64,"+d.img,s.uuid=d.uuid)})}const J=D(()=>d=>d?"登录中":"登录");return(d,r)=>{const g=se,p=te,h=oe,B=re,U=ae,k=le,I=ne,A=G,q=ie,z=$("router-link"),M=H;return K(),X("div",be,[c("div",ve,[we,a(A,{modelValue:u.value,"onUpdate:modelValue":r[5]||(r[5]=i=>u.value=i),class:"tabs",onTabClick:j},{default:n(()=>[a(I,{label:"密码登陆",name:"first"},{default:n(()=>[a(B,{model:s,ref_key:"accountFormRef",ref:l,rules:_,style:{width:"100%"}},{default:n(()=>[a(p,{prop:"userName"},{default:n(()=>[a(g,{modelValue:s.userName,"onUpdate:modelValue":r[0]||(r[0]=i=>s.userName=i),modelModifiers:{trim:!0},placeholder:"请输入用户名",clearable:"","prefix-icon":y(Q),size:"large",style:{width:"100%"}},null,8,["modelValue","prefix-icon"])]),_:1}),a(p,{prop:"password"},{default:n(()=>[a(g,{modelValue:s.password,"onUpdate:modelValue":r[1]||(r[1]=i=>s.password=i),modelModifiers:{trim:!0},placeholder:"请输入密码",type:"password",clearable:"","prefix-icon":y(W),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),a(p,{prop:"code"},{default:n(()=>[c("div",Se,[c("div",Ie,[a(g,{modelValue:s.code,"onUpdate:modelValue":r[2]||(r[2]=i=>s.code=i),modelModifiers:{trim:!0},placeholder:"请输入验证码",clearable:"",size:"large",onKeydown:r[3]||(r[3]=Y(i=>E(l.value),["enter"]))},null,8,["modelValue"])]),c("div",{class:"codePicture",onClick:S},[a(h,{style:{width:"100%",height:"100%"},src:y(m),fit:"fill"},null,8,["src"])])])]),_:1})]),_:1},8,["model","rules"]),c("div",ye,[c("div",null,[a(U,{modelValue:s.isRememberPassword,"onUpdate:modelValue":r[4]||(r[4]=i=>s.isRememberPassword=i),label:"记住密码",size:"small"},null,8,["modelValue"])]),c("div",null,[a(k,{href:""},{default:n(()=>[b("忘记密码?")]),_:1})])])]),_:1}),a(I,{label:"短信登录",name:"second"},{default:n(()=>[b("短信登录")]),_:1}),a(I,{label:"邮箱登陆",name:"third"},{default:n(()=>[b("邮箱登陆")]),_:1})]),_:1},8,["modelValue"]),c("div",Ne,[a(M,{direction:"vertical",size:15,alignment:"normal",style:{width:"100%"}},{default:n(()=>[a(q,{type:"primary",size:"large",class:"loginBtn",onClick:r[6]||(r[6]=i=>E(l.value)),loading:f.value},{default:n(()=>[b(Z(J.value(f.value)),1)]),_:1},8,["loading"]),c("div",Ee,[a(z,{to:"/member/register"},{default:n(()=>[a(k,{type:"primary"},{default:n(()=>[b("没有账号我要免费注册>>")]),_:1})]),_:1})])]),_:1})])])])}}};export{Re as default};
