import{a as d}from"./axios-47b9d439.js";import{a4 as p,a5 as c,u as g}from"./index-4ff56a06.js";import{e as h}from"./index-48071e1a.js";const I={set(e,t){sessionStorage&&e!=null&&t!=null&&sessionStorage.setItem(e,t)},get(e){return!sessionStorage||e==null?null:sessionStorage.getItem(e)},setJSON(e,t){t!=null&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);if(t!=null)return JSON.parse(t)},remove(e){sessionStorage.removeItem(e)}},N={set(e,t){localStorage&&e!=null&&t!=null&&localStorage.setItem(e,t)},get(e){return!localStorage||e==null?null:localStorage.getItem(e)},setJSON(e,t){t!=null&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);if(t!=null)return JSON.parse(t)},remove(e){localStorage.removeItem(e)}},u={session:I,local:N},m={401:"认证失败，无法访问系统资源",403:"当前操作没有权限",404:"访问资源不存在",default:"系统未知错误，请反馈给管理员"};function b(e){let t="";for(const a of Object.keys(e)){const r=e[a];var s=encodeURIComponent(a)+"=";if(r!==null&&r!==""&&typeof r<"u")if(typeof r=="object"){for(const n of Object.keys(r))if(r[n]!==null&&r[n]!==""&&typeof r[n]<"u"){let l=a+"["+n+"]";var o=encodeURIComponent(l)+"=";t+=o+encodeURIComponent(r[n])+"&"}}else t+=s+encodeURIComponent(r)+"&"}return t}const S={VITE_BASE_API:"/prod-api",BASE_URL:"/",MODE:"prod",DEV:!1,PROD:!0,SSR:!1};let f={show:!1};d.defaults.headers["Content-Type"]="application/json;charset=utf-8";const O=d.create({baseURL:S.VITE_BASE_API,timeout:1e4});console.log("当前环境",S.VITE_BASE_API);O.interceptors.request.use(e=>{p.start();const t=(e.headers||{}).isToken===!1;if(c()&&!t&&(e.headers.Authorization="Bearer "+c()),e.method==="get"&&e.params){let s=e.url+"?"+b(e.params);s=s.slice(0,-1),e.params={},e.url=s}if(e.method==="post"||e.method==="put"){const s={url:e.url,data:typeof e.data=="object"?JSON.stringify(e.data):e.data,time:new Date().getTime()},o=u.session.getJSON("sessionObj");if(o==null||o==="")u.session.setJSON("sessionObj",s);else{const a=o.url,r=o.data,n=o.time,l=1e3;if(r===s.data&&s.time-n<l&&a===s.url){const i="数据正在处理，请勿重复提交";return console.warn(`[${a}]: `+i),Promise.reject(new Error(i))}else u.session.setJSON("sessionObj",s)}}return e},e=>{console.log(e),Promise.reject(e)});O.interceptors.response.use(e=>{p.done();const t=e.data.code||200,s=m[t]||e.data.msg||m.default;return e.request.responseType==="blob"||e.request.responseType==="arraybuffer"?e.data:t===401?(f.show||(f.show=!0,g().replace("/401")),Promise.reject("无效的会话，或者会话已过期，请重新登录。")):t===500?(h(s),Promise.reject(new Error(s))):e.data});export{O as s};
