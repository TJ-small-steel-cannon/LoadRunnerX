import{g as A,u as q,o as te,r as w,a as b,c as oe,b as se,d as le,e as re,f as m,h as o,w as r,E as ae,i as ne,j as y,k as O,l as E,m as ie,n as I,t as P,s as de,p as ue,q as me,v as ce,x as pe,y as fe,z as ge,A as _e,B as be}from"./index-29126af5.js";import{e as he,u as ve,s as ye}from"./jsencrypt.min-c1c4be45.js";import{a as $}from"./axios-47b9d439.js";import{d as we,e as xe}from"./jsencrpyt-256e264c.js";const Se={set(e,l){sessionStorage&&e!=null&&l!=null&&sessionStorage.setItem(e,l)},get(e){return!sessionStorage||e==null?null:sessionStorage.getItem(e)},setJSON(e,l){l!=null&&this.set(e,JSON.stringify(l))},getJSON(e){const l=this.get(e);if(l!=null)return JSON.parse(l)},remove(e){sessionStorage.removeItem(e)}},Ie={set(e,l){localStorage&&e!=null&&l!=null&&localStorage.setItem(e,l)},get(e){return!localStorage||e==null?null:localStorage.getItem(e)},setJSON(e,l){l!=null&&this.set(e,JSON.stringify(l))},getJSON(e){const l=this.get(e);if(l!=null)return JSON.parse(l)},remove(e){localStorage.removeItem(e)}},z={session:Se,local:Ie},J={401:"认证失败，无法访问系统资源",403:"当前操作没有权限",404:"访问资源不存在",default:"系统未知错误，请反馈给管理员"};function Ve(e){let l="";for(const g of Object.keys(e)){const u=e[g];var a=encodeURIComponent(g)+"=";if(u!==null&&u!==""&&typeof u<"u")if(typeof u=="object"){for(const f of Object.keys(u))if(u[f]!==null&&u[f]!==""&&typeof u[f]<"u"){let n=g+"["+f+"]";var c=encodeURIComponent(n)+"=";l+=c+encodeURIComponent(u[f])+"&"}}else l+=a+encodeURIComponent(u)+"&"}return l}const D={VITE_BASE_API:"/prod-api",BASE_URL:"/",MODE:"prod",DEV:!1,PROD:!0,SSR:!1};let M={show:!1};$.defaults.headers["Content-Type"]="application/json;charset=utf-8";const R=$.create({baseURL:D.VITE_BASE_API,timeout:1e4});console.log("当前环境",D.VITE_BASE_API);R.interceptors.request.use(e=>{const l=(e.headers||{}).isToken===!1;if(A()&&!l&&(e.headers.Authorization="Bearer "+A()),e.method==="get"&&e.params){let a=e.url+"?"+Ve(e.params);a=a.slice(0,-1),e.params={},e.url=a}if(e.method==="post"||e.method==="put"){const a={url:e.url,data:typeof e.data=="object"?JSON.stringify(e.data):e.data,time:new Date().getTime()},c=z.session.getJSON("sessionObj");if(c==null||c==="")z.session.setJSON("sessionObj",a);else{const g=c.url,u=c.data,f=c.time,n=1e3;if(u===a.data&&a.time-f<n&&g===a.url){const _="数据正在处理，请勿重复提交";return console.warn(`[${g}]: `+_),Promise.reject(new Error(_))}else z.session.setJSON("sessionObj",a)}}return e},e=>{console.log(e),Promise.reject(e)});R.interceptors.response.use(e=>{const l=e.data.code||200,a=J[l]||e.data.msg||J.default;return e.request.responseType==="blob"||e.request.responseType==="arraybuffer"?e.data:l===401?(M.show||(M.show=!0,q().replace("/401")),Promise.reject("无效的会话，或者会话已过期，请重新登录。")):l===500?(he(a),Promise.reject(new Error(a))):e.data});function Re(){return R({url:"/captchaImage",headers:{isToken:!1},method:"get",timeout:2e4})}function Te(e){return R({url:"/login",headers:{isToken:!1},method:"post",timeout:1e4,data:e})}const Ce={class:"login"},ke={class:"loginContainer"},Ne=m("span",{class:"title"},"欢迎登录 LoadRunnerX 压力测试平台",-1),Oe={class:"codeImg"},Ee={class:"codeInput"},Pe={class:"operate"},ze={class:"phoneCode"},Ue=m("div",{class:"divider"},null,-1),Fe={class:"emailCode"},je=m("div",{class:"divider"},null,-1),Be={class:"publicModule"},Ae={class:"gotoRegister"},De={__name:"Login",setup(e){te(()=>{T()});const l=q(),a=ve(),c=w(null),g=w(null),u=w(null);let f=w("");const n=b({isRememberPassword:a.userInfo.isRememberPassword,userName:a.userInfo.userName,password:we(a.userInfo.password),code:a.userInfo.code,uuid:""}),_=b({phone:"",code:""}),x=b({email:"",code:""}),S=w("account"),Z=b({userName:[{required:!0,message:"请输入用户名!",trigger:"change"}],password:[{required:!0,message:"请输入密码!",trigger:"change"}],code:[{required:!0,message:"请输入验证码!",trigger:"change"}]}),K=b({phone:[{validator(s,t,i){!/^1[3-9]\d{9}$/.test(t)&&t!=""?(v.disabled=!0,i(new Error("请输入正确手机号"))):(t==""?v.disabled=!0:v.disabled=!1,i())},trigger:"change"}],code:[{required:!0,message:"请输入验证码!",trigger:"change"}]}),X=b({email:[{validator(s,t,i){!/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{3,4})$/.test(t)&&t!=""?(h.disabled=!0,i(new Error("请输入正确邮箱"))):(t==""?h.disabled=!0:h.disabled=!1,i())},trigger:"change"}],code:[{required:!0,message:"请输入验证码!",trigger:"change"}]}),V=w(!1),G=(s,t)=>{console.log(s,t)};function U(){S.value=="account"?c.value.validate(s=>{if(s){V.value=!0;const t={username:n.userName,password:n.password,code:n.code,uuid:n.uuid};Te(t).then(i=>{if(i.code==200){if(n.isRememberPassword){const p={...n,password:xe(n.password),code:""};a.setuserInfo(p)}else{const p={userName:"",password:"",isRememberPassword:!1};a.setuserInfo(p)}de(i.token),l.replace("/index")}}).catch(i=>{console.log("errMsg--->",i.message),T()}).finally(()=>{V.value=!1})}}):S.value=="phone"?g.value.validate(s=>{}):S.value=="email"&&u.value.validate(s=>{})}function T(){Re().then(s=>{s.code==200&&(f.value="data:image/gif;base64,"+s.img,n.uuid=s.uuid)})}const h=b({type:"primary",btnText:"获取验证码",disabled:!0}),v=b({type:"primary",btnText:"获取验证码",disabled:!0});function F(s){s.type="",s.disabled=!0,s.btnText="请稍候...",setTimeout(()=>{H(60,s)},500)}function H(s,t){ye("验证码已发送!"),s=s||60,t.btnText=s+"s后获取",setTimeout(()=>{s>0&&(t.btnText=s+"s后获取",--s)},1e3);let i=setInterval(()=>{s>0?(t.btnText=s+"s后获取",--s):(t.btnText="获取验证码",t.disabled=!1,t.type="primary",clearInterval(i))},1e3)}const L=oe(()=>s=>s?"登录中":"登录");return(s,t)=>{const i=ue,p=me,Q=ce,C=pe,W=fe,j=ge,B=se("router-link"),k=_e,N=be,Y=ae,ee=ne;return le(),re("div",Ce,[m("div",ke,[Ne,o(Y,{modelValue:S.value,"onUpdate:modelValue":t[11]||(t[11]=d=>S.value=d),class:"tabs",onTabClick:G},{default:r(()=>[o(k,{label:"密码登陆",name:"account"},{default:r(()=>[o(C,{model:n,ref_key:"accountFormRef",ref:c,rules:Z,style:{width:"100%"}},{default:r(()=>[o(p,{prop:"userName"},{default:r(()=>[o(i,{modelValue:n.userName,"onUpdate:modelValue":t[0]||(t[0]=d=>n.userName=d),modelModifiers:{trim:!0},placeholder:"请输入用户名",clearable:"","prefix-icon":y(O),size:"large",style:{width:"100%"}},null,8,["modelValue","prefix-icon"])]),_:1}),o(p,{prop:"password"},{default:r(()=>[o(i,{modelValue:n.password,"onUpdate:modelValue":t[1]||(t[1]=d=>n.password=d),modelModifiers:{trim:!0},placeholder:"请输入密码",type:"password",clearable:"","prefix-icon":y(E),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),o(p,{prop:"code"},{default:r(()=>[m("div",Oe,[m("div",Ee,[o(i,{modelValue:n.code,"onUpdate:modelValue":t[2]||(t[2]=d=>n.code=d),modelModifiers:{trim:!0},placeholder:"请输入验证码",clearable:"",size:"large",onKeydown:t[3]||(t[3]=ie(d=>U(c.value),["enter"]))},null,8,["modelValue"])]),m("div",{class:"codePicture",onClick:T},[o(Q,{style:{width:"100%",height:"100%"},src:y(f),fit:"fill"},null,8,["src"])])])]),_:1})]),_:1},8,["model","rules"]),m("div",Pe,[m("div",null,[o(W,{modelValue:n.isRememberPassword,"onUpdate:modelValue":t[4]||(t[4]=d=>n.isRememberPassword=d),label:"记住密码",size:"small"},null,8,["modelValue"])]),m("div",null,[o(B,{to:"/member/retrievePassword"},{default:r(()=>[o(j,null,{default:r(()=>[I("忘记密码?")]),_:1})]),_:1})])])]),_:1}),o(k,{label:"短信登录",name:"phone"},{default:r(()=>[o(C,{model:_,ref_key:"phoneFormRef",ref:g,rules:K,style:{width:"100%"}},{default:r(()=>[o(p,{prop:"phone"},{default:r(()=>[o(i,{modelValue:_.phone,"onUpdate:modelValue":t[5]||(t[5]=d=>_.phone=d),modelModifiers:{trim:!0},placeholder:"请输入手机号",clearable:"","prefix-icon":y(O),size:"large",style:{width:"100%"}},null,8,["modelValue","prefix-icon"])]),_:1}),o(p,{prop:"code"},{default:r(()=>[m("div",ze,[o(i,{modelValue:_.code,"onUpdate:modelValue":t[6]||(t[6]=d=>_.code=d),modelModifiers:{trim:!0},placeholder:"请输入验证码",type:"password","prefix-icon":y(E),size:"large"},null,8,["modelValue","prefix-icon"]),Ue,o(N,{link:"",type:v.type,class:"btnCode",disabled:v.disabled,onClick:t[7]||(t[7]=d=>F(v))},{default:r(()=>[I(P(v.btnText),1)]),_:1},8,["type","disabled"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),o(k,{label:"邮箱登陆",name:"email"},{default:r(()=>[o(C,{model:x,ref_key:"emailFormRef",ref:u,rules:X,style:{width:"100%"}},{default:r(()=>[o(p,{prop:"email"},{default:r(()=>[o(i,{modelValue:x.email,"onUpdate:modelValue":t[8]||(t[8]=d=>x.email=d),modelModifiers:{trim:!0},placeholder:"请输入邮箱",clearable:"","prefix-icon":y(O),size:"large",style:{width:"100%"}},null,8,["modelValue","prefix-icon"])]),_:1}),o(p,{prop:"code"},{default:r(()=>[m("div",Fe,[o(i,{modelValue:x.code,"onUpdate:modelValue":t[9]||(t[9]=d=>x.code=d),modelModifiers:{trim:!0},placeholder:"请输入验证码",type:"password","prefix-icon":y(E),size:"large"},null,8,["modelValue","prefix-icon"]),je,o(N,{link:"",type:h.type,class:"btnCode",disabled:h.disabled,onClick:t[10]||(t[10]=d=>F(h))},{default:r(()=>[I(P(h.btnText),1)]),_:1},8,["type","disabled"])])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"]),m("div",Be,[o(ee,{direction:"vertical",size:15,alignment:"normal",style:{width:"100%"}},{default:r(()=>[o(N,{type:"primary",size:"large",class:"loginBtn",onClick:U,loading:V.value},{default:r(()=>[I(P(L.value(V.value)),1)]),_:1},8,["loading"]),m("div",Ae,[o(B,{to:"/member/register"},{default:r(()=>[o(j,{type:"primary"},{default:r(()=>[I("没有账号我要免费注册>>")]),_:1})]),_:1})])]),_:1})])])])}}};export{De as default};
